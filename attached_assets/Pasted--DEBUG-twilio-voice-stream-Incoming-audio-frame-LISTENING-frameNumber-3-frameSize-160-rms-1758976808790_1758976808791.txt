[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":3,"frameSize":160,"rms":"9.2","hexDump":"7e 7e 7c fd ff fd 7d 7e ff 7e 7e ff fe 7e fe 7e... (160 bytes total)"}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":2,"frameSize":160,"rms":"10.4","hexDump":"7e fe 7e 7d fe 7e 7b 7e fe 7d ff 7e ff 7e 7c fd... (160 bytes total)"}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":1,"frameSize":160,"rms":"10.4","hexDump":"7d 7e 7d 7d 7e 7d 7e fc fe fc fd 7d ff 7d 7e 7c... (160 bytes total)"}
[ERROR] [twilio-voice-stream] ElevenLabs REST API error {"status":401,"statusText":"Unauthorized","error":"{\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}"}
[ERROR] [twilio-voice-stream] ElevenLabs REST API failed {"error":"ElevenLabs REST API error: 401 - {\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}","stack":"Error: ElevenLabs REST API error: 401 - {\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}\n at AIVoiceSession.speakResponseREST (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1100:15)\n at eventLoopTick (ext:core/01_core.js:175:7)\n at async AIVoiceSession.speakResponseFixed (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:769:7)\n at async AIVoiceSession.speakResponse (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:739:5)\n at async AIVoiceSession.processUserSpeech (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:599:9)\n at async AIVoiceSession.handleListeningState (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:488:11)\n at async AIVoiceSession.processAudioFrame (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:449:9)\n at async AIVoiceSession.handleTwilioMessage (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:427:9)\n at async WebSocket.ws.onmessage (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:295:9)"}
[ERROR] [twilio-voice-stream] ElevenLabs WebSocket streaming failed, attempting REST fallback {"error":"ElevenLabs WebSocket error - check logs for details","stack":"Error: ElevenLabs WebSocket error - check logs for details\n at WebSocket.ws.onclose (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1015:18)\n at WebSocket.wrappedHandler (ext:deno_web/02_event.js:1400:12)\n at innerInvokeEventListeners (ext:deno_web/02_event.js:757:7)\n at invokeEventListeners (ext:deno_web/02_event.js:804:5)\n at dispatch (ext:deno_web/02_event.js:661:9)\n at WebSocket.dispatchEvent (ext:deno_web/02_event.js:1041:12)\n at WebSocket.[[[eventLoop]]] (ext:deno_websocket/01_websocket.js:534:16)\n at eventLoopTick (ext:core/01_core.js:175:7)"}
[INFO] [twilio-voice-stream] Using ElevenLabs REST API fallback {"textLength":86,"voiceId":"Xb7hH8MSUJpSbSDYk0k2"}
[INFO] [twilio-voice-stream] üîå ElevenLabs WebSocket closed {"code":1005,"reason":"No reason provided","wasClean":true,"framesReceived":0,"wasConnected":true,"hadError":true,"hasReceivedACK":false,"protocol":"Bearer token authentication","authFailure":"No","possibleIssues":["Verify API key is valid","Check voiceId exists","Ensure Bearer token format: authorization=Bearer%20<api_key>","Verify proper message format"]}
[ERROR] [twilio-voice-stream] ‚ùå ElevenLabs error message {"error":"authentication_required","code":1008,"message":"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).","details":{"message":"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).","error":"authentication_required","code":1008}}
[INFO] [twilio-voice-stream] üì• ElevenLabs message received {"messageNumber":1,"type":"message,error,code","hasAudio":false,"hasError":true,"hasMeta":false,"isFinal":false,"messageKeys":["message","error","code"],"fullMessage":"{\"message\":\"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).\",\"error\":\"authentication_required\",\"code\":1008}","audioPreview":null,"framesReceived":0,"protocol":"Using official 3-phase protocol"}
[DEBUG] [twilio-voice-stream] üîö PHASE 3 queued: Close message {"text":"empty string for EOS","phase":"3 of 3"}
[INFO] [twilio-voice-stream] ‚úÖ ElevenLabs WebSocket connected, implementing 3-phase protocol
[DEBUG] [twilio-voice-stream] üìù PHASE 2 queued: Text message {"textLength":86,"try_trigger_generation":true,"phase":"2 of 3"}
[INFO] [twilio-voice-stream] üì§ PHASE 1: Sending initialization message {"message":"text=\" \", voice_settings, generation_config","protocol":"Official ElevenLabs 3-phase protocol","phase":"1 of 3"}
[INFO] [twilio-voice-stream] Connecting to ElevenLabs WebSocket with Bearer token authentication {"voiceId":"Xb7hH8MSUJpSbSDYk0k2","url":"wss://api.elevenlabs.io/v1/text-to-speech/Xb7hH8MSUJpSbSDYk0k2/stream-input?authorization=Bearer%20[REDACTED]&model_id=eleven_turbo_v2_5&output_format=ulaw_8000&optimize_streaming_latency=3","protocol":"Bearer token authentication in URL query (Deno/Edge compatible)","textLength":86,"implementation":"Proven method for Deno/Supabase Edge Functions"}
[INFO] [twilio-voice-stream] Starting ElevenLabs TTS with WebSocket streaming {"textLength":86,"voiceId":"Xb7hH8MSUJpSbSDYk0k2","codec":"mulaw","frameSize":160,"streamingMode":"websocket"}
[DEBUG] [twilio-voice-stream] OpenAI response received {"hasResponse":true,"responseLength":86,"usage":{"prompt_tokens":66,"completion_tokens":19,"total_tokens":85,"prompt_tokens_details":{"cached_tokens":0,"audio_tokens":0},"completion_tokens_details":{"reasoning_tokens":0,"audio_tokens":0,"accepted_prediction_tokens":0,"rejected_prediction_tokens":0}}}
[DEBUG] [twilio-voice-stream] OpenAI chat request {"model":"gpt-4o-mini","messageCount":4,"maxTokens":150,"temperature":0.7}
[DEBUG] [twilio-voice-stream] Whisper transcription result {"hasText":true,"textLength":3}
[INFO] [twilio-voice-stream] Transcription completed {"transcript":"You","transcriptLength":3}
[ERROR] [twilio-voice-stream] ‚è±Ô∏è ElevenLabs ACK timeout after connection {"readyState":3,"hasReceivedACK":false,"framesReceived":0,"possibleCauses":["Invalid initialization message format","Authentication failed despite connection","Invalid voiceId or model_id"]}
[DEBUG] [twilio-voice-stream] Starting Whisper transcription {"audioSize":5164,"model":"whisper-1"}
[INFO] [twilio-voice-stream] Processing user speech {"bufferLength":16,"durationMs":320}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":3,"frameSize":160,"rms":"4.0","hexDump":"ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff... (160 bytes total)"}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":2,"frameSize":160,"rms":"4.0","hexDump":"ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff... (160 bytes total)"}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":1,"frameSize":160,"rms":"4.0","hexDump":"ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff... (160 bytes total)"}
[ERROR] [twilio-voice-stream] ElevenLabs REST API error {"status":401,"statusText":"Unauthorized","error":"{\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}"}
[ERROR] [twilio-voice-stream] ElevenLabs REST API failed {"error":"ElevenLabs REST API error: 401 - {\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}","stack":"Error: ElevenLabs REST API error: 401 - {\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}\n at AIVoiceSession.speakResponseREST (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1100:15)\n at eventLoopTick (ext:core/01_core.js:175:7)\n at async AIVoiceSession.speakResponseFixed (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:769:7)\n at async AIVoiceSession.speakResponse (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:739:5)\n at async AIVoiceSession.processUserSpeech (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:599:9)\n at async AIVoiceSession.handleListeningState (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:488:11)\n at async AIVoiceSession.processAudioFrame (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:449:9)\n at async AIVoiceSession.handleTwilioMessage (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:427:9)\n at async WebSocket.ws.onmessage (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:295:9)"}
[ERROR] [twilio-voice-stream] ElevenLabs WebSocket streaming failed, attempting REST fallback {"error":"ElevenLabs WebSocket error - check logs for details","stack":"Error: ElevenLabs WebSocket error - check logs for details\n at WebSocket.ws.onclose (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1015:18)\n at WebSocket.wrappedHandler (ext:deno_web/02_event.js:1400:12)\n at innerInvokeEventListeners (ext:deno_web/02_event.js:757:7)\n at invokeEventListeners (ext:deno_web/02_event.js:804:5)\n at dispatch (ext:deno_web/02_event.js:661:9)\n at WebSocket.dispatchEvent (ext:deno_web/02_event.js:1041:12)\n at WebSocket.[[[eventLoop]]] (ext:deno_websocket/01_websocket.js:534:16)\n at eventLoopTick (ext:core/01_core.js:175:7)"}
[INFO] [twilio-voice-stream] Using ElevenLabs REST API fallback {"textLength":34,"voiceId":"Xb7hH8MSUJpSbSDYk0k2"}
[INFO] [twilio-voice-stream] üîå ElevenLabs WebSocket closed {"code":1005,"reason":"No reason provided","wasClean":true,"framesReceived":0,"wasConnected":true,"hadError":true,"hasReceivedACK":false,"protocol":"Bearer token authentication","authFailure":"No","possibleIssues":["Verify API key is valid","Check voiceId exists","Ensure Bearer token format: authorization=Bearer%20<api_key>","Verify proper message format"]}
[INFO] [twilio-voice-stream] üì• ElevenLabs message received {"messageNumber":1,"type":"message,error,code","hasAudio":false,"hasError":true,"hasMeta":false,"isFinal":false,"messageKeys":["message","error","code"],"fullMessage":"{\"message\":\"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).\",\"error\":\"authentication_required\",\"code\":1008}","audioPreview":null,"framesReceived":0,"protocol":"Using official 3-phase protocol"}
[ERROR] [twilio-voice-stream] ‚ùå ElevenLabs error message {"error":"authentication_required","code":1008,"message":"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).","details":{"message":"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).","error":"authentication_required","code":1008}}
[DEBUG] [twilio-voice-stream] Incoming audio frame (SPEAKING - barge-in detection) {"frameNumber":3,"frameSize":160,"rms":"4.0","threshold":800}
[INFO] [twilio-voice-stream] üì§ PHASE 1: Sending initialization message {"message":"text=\" \", voice_settings, generation_config","protocol":"Official ElevenLabs 3-phase protocol","phase":"1 of 3"}
[DEBUG] [twilio-voice-stream] üîö PHASE 3 queued: Close message {"text":"empty string for EOS","phase":"3 of 3"}
[DEBUG] [twilio-voice-stream] üìù PHASE 2 queued: Text message {"textLength":34,"try_trigger_generation":true,"phase":"2 of 3"}
[INFO] [twilio-voice-stream] ‚úÖ ElevenLabs WebSocket connected, implementing 3-phase protocol
[DEBUG] [twilio-voice-stream] Incoming audio frame (SPEAKING - barge-in detection) {"frameNumber":2,"frameSize":160,"rms":"4.0","threshold":800}
[DEBUG] [twilio-voice-stream] Incoming audio frame (SPEAKING - barge-in detection) {"frameNumber":1,"frameSize":160,"rms":"4.0","threshold":800}
[INFO] [twilio-voice-stream] Connecting to ElevenLabs WebSocket with Bearer token authentication {"voiceId":"Xb7hH8MSUJpSbSDYk0k2","url":"wss://api.elevenlabs.io/v1/text-to-speech/Xb7hH8MSUJpSbSDYk0k2/stream-input?authorization=Bearer%20[REDACTED]&model_id=eleven_turbo_v2_5&output_format=ulaw_8000&optimize_streaming_latency=3","protocol":"Bearer token authentication in URL query (Deno/Edge compatible)","textLength":34,"implementation":"Proven method for Deno/Supabase Edge Functions"}
[INFO] [twilio-voice-stream] Starting ElevenLabs TTS with WebSocket streaming {"textLength":34,"voiceId":"Xb7hH8MSUJpSbSDYk0k2","codec":"mulaw","frameSize":160,"streamingMode":"websocket"}
[DEBUG] [twilio-voice-stream] OpenAI response received {"hasResponse":true,"responseLength":34,"usage":{"prompt_tokens":48,"completion_tokens":9,"total_tokens":57,"prompt_tokens_details":{"cached_tokens":0,"audio_tokens":0},"completion_tokens_details":{"reasoning_tokens":0,"audio_tokens":0,"accepted_prediction_tokens":0,"rejected_prediction_tokens":0}}}
[DEBUG] [twilio-voice-stream] OpenAI chat request {"model":"gpt-4o-mini","messageCount":2,"maxTokens":150,"temperature":0.7}
[INFO] [twilio-voice-stream] Transcription completed {"transcript":"You","transcriptLength":3}
[DEBUG] [twilio-voice-stream] Whisper transcription result {"hasText":true,"textLength":3}
[DEBUG] [twilio-voice-stream] Starting Whisper transcription {"audioSize":8684,"model":"whisper-1"}
[INFO] [twilio-voice-stream] Processing user speech {"bufferLength":27,"durationMs":540}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":3,"frameSize":160,"rms":"4.0","hexDump":"ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff... (160 bytes total)"}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":2,"frameSize":160,"rms":"4.0","hexDump":"ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff... (160 bytes total)"}
[DEBUG] [twilio-voice-stream] Incoming audio frame (LISTENING) {"frameNumber":1,"frameSize":160,"rms":"4.0","hexDump":"ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff ff... (160 bytes total)"}
[ERROR] [twilio-voice-stream] ElevenLabs REST API failed {"error":"ElevenLabs REST API error: 401 - {\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}","stack":"Error: ElevenLabs REST API error: 401 - {\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}\n at AIVoiceSession.speakResponseREST (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1100:15)\n at eventLoopTick (ext:core/01_core.js:175:7)\n at async AIVoiceSession.speakResponseFixed (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:769:7)\n at async AIVoiceSession.startGreeting (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1719:7)\n at async AIVoiceSession.handleTwilioMessage (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:422:9)\n at async WebSocket.ws.onmessage (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:295:9)"}
[ERROR] [twilio-voice-stream] ElevenLabs REST API error {"status":401,"statusText":"Unauthorized","error":"{\"detail\":{\"status\":\"invalid_authorization_header\",\"message\":\"Provided authorization header was invalid.\"}}"}
[INFO] [twilio-voice-stream] Using ElevenLabs REST API fallback {"textLength":69,"voiceId":"Xb7hH8MSUJpSbSDYk0k2"}
[ERROR] [twilio-voice-stream] ElevenLabs WebSocket streaming failed, attempting REST fallback {"error":"ElevenLabs WebSocket error - check logs for details","stack":"Error: ElevenLabs WebSocket error - check logs for details\n at WebSocket.ws.onclose (file:///tmp/user_fn_gnqqktmslswgjtvxfvdo_2c5e4c84-316c-4bd2-9c06-48a5d8229532_547/source/supabase/functions/twilio-voice-stream/index.ts:1015:18)\n at WebSocket.wrappedHandler (ext:deno_web/02_event.js:1400:12)\n at innerInvokeEventListeners (ext:deno_web/02_event.js:757:7)\n at invokeEventListeners (ext:deno_web/02_event.js:804:5)\n at dispatch (ext:deno_web/02_event.js:661:9)\n at WebSocket.dispatchEvent (ext:deno_web/02_event.js:1041:12)\n at WebSocket.[[[eventLoop]]] (ext:deno_websocket/01_websocket.js:534:16)\n at eventLoopTick (ext:core/01_core.js:175:7)"}
[INFO] [twilio-voice-stream] üîå ElevenLabs WebSocket closed {"code":1005,"reason":"No reason provided","wasClean":true,"framesReceived":0,"wasConnected":true,"hadError":true,"hasReceivedACK":false,"protocol":"Bearer token authentication","authFailure":"No","possibleIssues":["Verify API key is valid","Check voiceId exists","Ensure Bearer token format: authorization=Bearer%20<api_key>","Verify proper message format"]}
[INFO] [twilio-voice-stream] üì• ElevenLabs message received {"messageNumber":1,"type":"message,error,code","hasAudio":false,"hasError":true,"hasMeta":false,"isFinal":false,"messageKeys":["message","error","code"],"fullMessage":"{\"message\":\"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).\",\"error\":\"authentication_required\",\"code\":1008}","audioPreview":null,"framesReceived":0,"protocol":"Using official 3-phase protocol"}
[ERROR] [twilio-voice-stream] ‚ùå ElevenLabs error message {"error":"authentication_required","code":1008,"message":"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).","details":{"message":"Neither xi-api-key nor authorization header were found. Set one of them, or add them in the first message sent (xi_api_key).","error":"authentication_required","code":1008}}
[DEBUG] [twilio-voice-stream] üìù PHASE 2 queued: Text message {"textLength":69,"try_trigger_generation":true,"phase":"2 of 3"}
[DEBUG] [twilio-voice-stream] üîö PHASE 3 queued: Close message {"text":"empty string for EOS","phase":"3 of 3"}
[INFO] [twilio-voice-stream] üì§ PHASE 1: Sending initialization message {"message":"text=\" \", voice_settings, generation_config","protocol":"Official ElevenLabs 3-phase protocol","phase":"1 of 3"}
[INFO] [twilio-voice-stream] ‚úÖ ElevenLabs WebSocket connected, implementing 3-phase protocol
[INFO] [twilio-voice-stream] Connecting to ElevenLabs WebSocket with Bearer token authentication {"voiceId":"Xb7hH8MSUJpSbSDYk0k2","url":"wss://api.elevenlabs.io/v1/text-to-speech/Xb7hH8MSUJpSbSDYk0k2/stream-input?authorization=Bearer%20[REDACTED]&model_id=eleven_turbo_v2_5&output_format=ulaw_8000&optimize_streaming_latency=3","protocol":"Bearer token authentication in URL query (Deno/Edge compatible)","textLength":69,"implementation":"Proven method for Deno/Supabase Edge Functions"}
[INFO] [twilio-voice-stream] Starting ElevenLabs TTS with WebSocket streaming {"textLength":69,"voiceId":"Xb7hH8MSUJpSbSDYk0k2","codec":"mulaw","frameSize":160,"streamingMode":"websocket"}
[DEBUG] [twilio-voice-stream] Buffer warmup complete {"framesSent":10}
[INFO] [twilio-voice-stream] Starting greeting {"streamSid":"MZ45188bc713cb34a3c924cb4c23da8ea0","greetingLength":0,"businessName":"this business"}
[DEBUG] [twilio-voice-stream] Using Œº-law silence pattern {"fillValue":"0xFF","frameSize":160}
[DEBUG] [twilio-voice-stream] Starting buffer warmup {"codec":"mulaw","frameSize":160,"warmupFrames":10,"warmupDurationMs":200}
[INFO] [twilio-voice-stream] ‚úÖ FORCED codec configuration to Œº-law for optimal audio quality {"codec":"mulaw","frameSize":160,"framesPerSecond":50,"durationPerFrame":20,"note":"Outbound codec explicitly forced to Œº-law for ElevenLabs compatibility"}
[INFO] [twilio-voice-stream] ‚úÖ Codec set to Œº-law {"codec":"mulaw","frameSize":160,"bytesPerFrame":160}
[DEBUG] [twilio-voice-stream] Detected encoding type {"encoding":"audio/x-mulaw","originalEncoding":"audio/x-mulaw"}
[INFO] [twilio-voice-stream] Media format negotiated {"mediaFormat":{"encoding":"audio/x-mulaw","sampleRate":8000,"channels":1},"encoding":"audio/x-mulaw","sampleRate":8000,"channels":1}
[INFO] [twilio-voice-stream] StreamSid captured {"streamSid":"MZ45188bc713cb34a3c924cb4c23da8ea0"}
[DEBUG] [twilio-voice-stream] Full start event received {"startEvent":{"accountSid":"ACe6e513d70609f6d6376a80db0b4214d5","streamSid":"MZ45188bc713cb34a3c924cb4c23da8ea0","callSid":"CA682d0c5317880474772a9feadda1b90e","tracks":["inbound"],"mediaFormat":{"encoding":"audio/x-mulaw","sampleRate":8000,"channels":1},"customParameters":{"businessName":"this business","phoneNumber":"+19169450065","from":"+19169450065","to":"+19194203058"}}}
[INFO] [twilio-voice-stream] Call started {"streamSid":"MZ45188bc713cb34a3c924cb4c23da8ea0","callSid":"CA682d0c5317880474772a9feadda1b90e"}
[INFO] [twilio-voice-stream] Connected to Twilio WebSocket - waiting for start event
[INFO] [twilio-voice-stream] WebSocket connection established
[INFO] [twilio-voice-stream] AIVoiceSession initialized successfully {"tenantId":"","businessName":"this business","voiceId":"Xb7hH8MSUJpSbSDYk0k2","greetingLength":0,"hasOpenAIKey":true,"hasElevenLabsKey":true,"maxSessionDuration":"150s (Free) / 400s (Pro)","features":["WebSocket streaming","Barge-in detection","VAD with 500ms silence","Database-driven prompts","Session timeout protection"]}
[INFO] [twilio-voice-stream] Twilio WebSocket connection request {"tenantId":"","businessName":"this business","voiceId":"Xb7hH8MSUJpSbSDYk0k2","greetingProvided":false,"headers":{"host":"edge-runtime.supabase.com","origin":null,"userAgent":"Twilio.TmeWs/1.0"},"production":true,"authRequired":false}
Listening on http://localhost:9999/